<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập thư viện</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<header>
    <div class="web-header">
        <div class="header-content">
            <div class="logo-wrapper">
                <img src="/img/logo.png" alt="Logo" class="header-logo-img">
            </div>
            <div class="text-wrapper">
                <span class="sublogo">Hệ thống quản lý thư viện</span>
                <h1 class="mainlogo">Trường Chính Trị Cần Thơ</h1>
            </div>
        </div>
    </div>
</header>

<div class="login-page-wrapper">
    <div class="login-form">
        <div class="text-center mb-4">
            <img src="/img/logo.png" style="height: 200px;">
            <h4 class="mt-3 fw-bold" style="color: #d32f2f;">ĐĂNG NHẬP THƯ VIỆN</h4>
        </div>
        
        <form id="loginForm">
            <div class="mb-3">
                <label class="form-label fw-bold">Tên đăng nhập:</label>
                <input type="text" name="username" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label fw-bold">Mật khẩu:</label>
                <input type="password" name="pass" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-danger w-100 py-2 fw-bold">ĐĂNG NHẬP</button>
        </form>
    </div>
</div>
<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = e.target.username.value;
    const password = e.target.pass.value;

    try {
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }) 
        });

        const result = await response.json();

        if (result.success) {
            // 1. Thiết lập trạng thái đăng nhập
            localStorage.setItem('isLoggedIn', 'true');

            await Swal.fire({
                icon: 'success',
                title: 'Thành công',
                text: 'Đang vào hệ thống...',
                timer: 1000,
                showConfirmButton: false
            });
            
            // 2. Vào thẳng Dashboard
            window.location.replace('dashboard.html'); 
        }
            else {
                    // Hiện thông báo lỗi trực tiếp từ JSON server trả về
                    Swal.fire({
                        icon: 'error',
                        title: 'Thất bại',
                        text: result.message || 'Sai tài khoản/mật khẩu'
                    });
                }
            } catch (error) {
                // Chỉ hiện lỗi này nếu server sập (không kết nối được)
                Swal.fire({
                    icon: 'warning',
                    title: 'Lỗi kết nối',
                    text: 'Server chưa bật hoặc bị lỗi mạng'
                });
            }
        });
</script>
</body>
</html>