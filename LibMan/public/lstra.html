<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch sử trả sách</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <h3 class="text-center mb-4 text-success fw-bold">DANH SÁCH ĐỘC GIẢ ĐÃ TRẢ</h3>
        <div class="table-responsive bg-white p-3 rounded shadow-sm">
            <table class="table table-striped">
                <thead class="table-success">
                    <tr>
                        <th>Người mượn</th>
                        <th>Mã sách</th>
                        <th>Tên sách</th>
                        <th>Ngày mượn</th>
                        <th>Hạn trả</th>
                        <th>Ngày trả thực tế</th>
                        <th>Ghi chú</th>
                    </tr>
                </thead>
                <tbody id="listDaTra"></tbody>
            </table>
        </div>
        <div class="text-center mt-3">
            <a href="/danh-sach-muon.html" class="btn btn-primary">Xem người chưa trả</a>
        </div>
    </div>

    <script>
        async function loadLichSu() {
            const res = await fetch('/api/lich-su-tra');
            const data = await res.json();
            const html = data.map(item => {
                const date1 = new Date(item.han_tra);
                const date2 = new Date(item.ngay_tra_thuc_te);
                const color = date2 > date1 ? 'text-danger' : 'text-success';
                const note = date2 > date1 ? 'Trả muộn' : 'Đúng hạn';

                return `
                    <tr>
                        <td>${item.hoten}</td>
                        <td>${item.book_id}</td>
                        <td>${item.tieude}</td>
                        <td>${new Date(item.ngay_muon).toLocaleDateString('vi-VN')}</td>
                        <td>${date1.toLocaleDateString('vi-VN')}</td>
                        <td class="${color} fw-bold">${date2.toLocaleDateString('vi-VN')}</td>
                        <td><span class="badge ${date2 > date1 ? 'bg-danger' : 'bg-success'}">${note}</span></td>
                    </tr>`;
            }).join('');
            document.getElementById('listDaTra').innerHTML = html;
        }
        loadLichSu();
    </script>
</body>
</html>